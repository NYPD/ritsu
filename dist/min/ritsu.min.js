/* ritsu.js v0.2.4 
 * Created 2017-01-16
 * Licensed under the MIT license
 * Source code can be found here: https://github.com/NYPD/ritsu 
 */

if (typeof jQuery === 'undefined' && typeof $ === 'undefined') {
  throw new Error('ritsu.js requires jQuery or a jQuery-compatible API');
}

var ritsu = (function() {
var rules=function(){var a=[],b=function(b){for(var c=Array.isArray(b),d=null,e=0;e<a.length;e++){var f=c?b.indexOf(a[e].ruleClass)===-1:a[e].ruleClass!==b;if(!f){d=a[e];break}}return d},c=function(a,b,c,d){var f=Array.isArray(a),g="object"==typeof a&&!f;f||g?(g&&(a=[a]),a.forEach(function(a){e(a.ruleType,a.ruleClass,a.validationFunction,a.errorMessage)})):e(a,b,c,d)},d=function(a,b,c,d){this.ruleType=a,this.ruleClass=b,this.validate=c,this.getErrorMessage=d},e=function(c,e,f,g){if("alpha"!==c&&"numeric"!==c)throw new Error('The rule type for a new validation rule must be either "alpha" or "numeric"');if("string"!=typeof e)throw new Error("The rule class for a new validation rule is missing or is not of type string");if("function"!=typeof f)throw new Error("The validation function for a new validation rule is missing or is not of type function");void 0===g&&(g=new Function("",'return "Invalid value";')),"string"==typeof g&&(g=new Function("",'return "'+g+'";'));var h=b(e);if(null!==h){var i=a.indexOf(h);a.splice(i,1)}a.push(new d(c,e,f,g))},f=function(a){var b=a.value,c=a.hasAttribute("data-no-space"),d="^([A-Za-z@.-])+$",e=new RegExp(d.replace(/@/g,c?"":"\\s"));return e.test(b)},g=function(a){return/(^\d{5}([\s-]?\d{4})?$)|(^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} ?\d{1}[A-Z]{1}\d{1}$)/.test(a.value)},h=function(a){var b=a.value,c=a.hasAttribute("data-no-space"),d="^([a-zA-Z0-9@]+)$",e=new RegExp(d.replace(/@/g,c?"":"\\s"));return e.test(b)},i=function(a){return/^(\S+@\S+\.\S+)$/.test(a.value)},j=function(a){var b=a.value,c=a.hasAttribute("data-no-thousands-separator"),d=/^-?(([\d]{1,3}(,{1}[\d]{3})*)|[\d]+)$/.test(b);return c&&(d=d&&b.indexOf(",")===-1),d},k=function(a){var b="Enter a whole number",c=a.hasAttribute("min"),d=a.hasAttribute("max");return c&&d?b=b+" from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" greater or equal to "+a.getAttribute("min"):d&&(b=b+" lesser or equal to "+a.getAttribute("max")),b},l=function(a){var b=a.value,c=a.hasAttribute("data-no-thousands-separator"),d=a.getAttribute("data-decimal-max");null===d&&(d=2);var e="^-?((([\\d]{1,3}(,[\\d]{3})*)+(\\.[\\d]{1,decimalPlaces})?)|[\\d]+(\\.[\\d]{1,decimalPlaces})?)$",f=new RegExp(e.replace(/decimalPlaces/g,d)),g=f.test(b);return c&&(g=g&&b.indexOf(",")===-1),g},m=function(a){var b="Please enter a number",c=a.hasAttribute("min"),d=a.hasAttribute("max"),e=a.hasAttribute("data-decimal-max")?a.getAttribute("data-decimal-max"):2;return b+=" with "+e+" decimal places max",c&&d?b=b+" and from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" and greater or equal to "+a.getAttribute("min"):d&&(b=b+" and lesser or equal to "+a.getAttribute("max")),b},n=function(a){return/^(\d{4})$/.test(a.value)},o=function(a){var b="Please enter a 4 digit year",c=a.hasAttribute("min"),d=a.hasAttribute("max");return c&&d?b=b+" from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" greater or equal to "+a.getAttribute("min"):d&&(b=b+" lesser or equal to "+a.getAttribute("max")),b},p=function(a){var b=$(a),c=null!==b.datepicker("getDate");return c};return e("alpha","alpha-only",f,"Only letters, spaces, hypens, and periods are allowed"),e("alpha","alpha-zip",g,"Enter a valid zip code"),e("alpha","alpha-numeric",h,"Enter only alphanumeric characters"),e("alpha","alpha-email",i,"Make sure the email is correct"),e("numeric","numeric-whole",j,k),e("numeric","numeric-decimal",l,m),e("numeric","numeric-full-year",n,o),e("numeric","numeric-jquery-date",p,"Please select a date from the date picker"),{getRuleByRuleClass:b,addValidationRule:c}},validation=function(a){var b=function(a){var b=$(a),e=!0,f=b.prop("disabled")===!0;if(f)return e;var g=b.is("input, textarea"),h=b.is("select");return g&&(e=c(a)),h&&(e=d(a)),e},c=function(a){var b=!0,c=a.classList.contains("alpha"),d=a.classList.contains("numeric"),g=a.hasAttribute("required"),h=a.value,i=""===$.trim(h)||void 0===h,j=i&&!g;return j?b:(c&&(b=e(a)),d&&(b=f(a)),c||d||!g||(b=!i),b)},d=function(a){var b=a.options[a.selectedIndex].value,c=a.hasAttribute("required"),d=""===$.trim(b)||void 0===b,e=d&&!c||!d;return e},e=function(b){var c=!0,d=b.getAttribute("pattern"),e=b.getAttribute("class"),f=null!==d;if(f){var g=new RegExp(d,"u");return g.test(b.value)}var h=null===e||""===e;if(h)return c;var i=e.split(" "),j=a.getRuleByRuleClass(i);return null===j?c:c=j.validate(b)},f=function(b){var c=!0,d=b.getAttribute("pattern"),e=null!==d;if(e){var f=new RegExp(d,"u");c=f.test(b.value)}else{var g=b.getAttribute("class"),h=g?g.split(" "):"",i=a.getRuleByRuleClass(h);null!==i&&(c=i.validate(b))}if(c){var j=Number(b.value.replace(",",""));if(isNaN(j))return c;var k=b.getAttribute("min"),l=b.getAttribute("max"),m=""===k||null===k?null:Number(k),n=""===l||null===l?null:Number(l),o=null!==m,p=null!==n;o&&p?c=j>=m&&j<=n:o?c=j>=m:p&&(c=j<=n)}return c};return{validateElement:b}},core=function(a,b){var c=!1,d=!0,e=!1,f=function(b){var f="object"!=typeof b;if(f)throw new Error("Invalid options to initialize ritsu.js");c=void 0!==b.useBootstrap3Stlying&&b.useBootstrap3Stlying,d=void 0===b.autoMarkInvalidFields||b.autoMarkInvalidFields,e=void 0!==b.autoShowErrorMessages&&b.autoShowErrorMessages;var g=b.validationRules;return void 0!==g&&a.addValidationRule(g),this},g=function(a){var b=void 0===a;b&&(a=$("input, textarea, select"));var c=!a.is("input, textarea, select");return c&&(a=a.find("input, textarea, select")),a.each(function(){var a=$(this),b=a.is('input[type="checkbox"]'),c=a.is('input[type="radio"]'),d=a.is('input[type="file"]');if(b||c)a.data("initialValue",a.is(":checked"));else if(d){var e=void 0!==a.data("simple-file-hash");if(e)return a.data("initialValue",a.data("simple-file-hash")),!0;var f=this.files.length>0,g=f?this.files[0].name+this.files[0].size:void 0;a.data("initialValue",g)}else a.data("initialValue",a.val())}),this},h=function(a){var b=!1,c=void 0===a;c&&(a=$("input, textarea, select"));var d=!a.is("input, textarea, select");return d&&(a=a.find("input, textarea, select")),a.each(function(){var a=$(this),c=void 0===a.data("initialValue");if(c)return!0;var d=a.is('input[type="checkbox"]'),e=a.is('input[type="radio"]'),f=a.is('input[type="file"]'),g=!1;if(d||e)g=a.data("initialValue")!=a.is(":checked");else if(f){var h=this.files.length>0;g=a.data("initialValue")!=(h?this.files[0].name+this.files[0].size:a.data("simple-file-hash"))}else g=a.data("initialValue")!=a.val();return g?(b=!0,!1):void 0}),b},i=function(a){var c=void 0===a;c&&(a=$("input, textarea, select"));var f=!a.is("input, textarea, select");f&&(a=a.find("input, textarea, select"));var g=!0;return a.each(function(){var a=$(this),c=!b.validateElement(this);c?(g=!1,a.data("invalid",!0)):(a.data("invalid",!1),l(a))}),d&&j(a),e&&k(a),g},j=function(a){var b=void 0===a;b&&(a=$("input, textarea, select"));var d=!a.is("input, textarea, select");return d&&(a=a.find("input, textarea, select")),a.each(function(){var a=$(this),b=c?a.closest(".form-group"):a,d=a.data("invalid");d?b.addClass("has-error"):b.removeClass("has-error")}),this},k=function(a){var b=void 0===a;b&&(a=$("input, textarea, select"));var d=!a.is("input, textarea, select");return d&&(a=a.find("input, textarea, select")),a.each(function(){var a=$(this);l(a);var b=!a.data("invalid");if(b)return!0;var d=m(this);if(c){var e=a.closest(".form-group"),f=e.find(".help-block"),g=f.length>0;g?f.prepend('<b class="ritsu-error"><em>'+d+'</em></b><br class="ritsu-error">'):e.append('<span class="help-block ritsu-error"><b><em>'+d+"</em></b></span>")}else{var h=a.attr("id"),i=0===a.closest(".error-label-container").length?a.parent():a.closest(".error-label-container");i.append('<label class="error-label"'+(h?' for="'+h+'"':"")+">"+d+"</label>")}}),this},l=function(a){if(a.closest("td").find(".error-label").remove(),c)return void a.closest(".form-group").find(".ritsu-error").remove();var b=a.closest(".error-label-container");0===b.length&&(b=a.parent()),b.find(".error-label, .warning-label").remove()},m=function(b){var c="SELECT"===b.nodeName;if(c)return"Please select an option";var d=b.hasAttribute("data-error-message");if(d)return b.getAttribute("data-error-message");var e="Invalid Value",f=b.getAttribute("class"),g=null===f||""===f;if(g)return e;var h=f.split(" "),i=a.getRuleByRuleClass(h);return null!==i&&(e=i.getErrorMessage(b)),e};return{rules:a,initialize:f,storeInitialFormValues:g,isFormDirty:h,validate:i,markInvalidFields:j,showErrorMessages:k}};
return core(rules(), validation(rules));
})();
