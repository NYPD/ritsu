/* ritsu.js v0.2.4 
 * Created 2016-12-28
 * Licensed under the MIT license
 * Source code can be found here: https://github.com/NYPD/ritsu 
 */

var rules=function(){var a=[],b=function(b){for(var c=Array.isArray(b),d=null,e=0;e<a.length;e++){var f=c?b.indexOf(a[e].ruleClass)===-1:a[e].ruleClass!==b;if(!f){d=a[e];break}}return d},c=function(a,b,c,d){var f=Array.isArray(a),g="object"==typeof a&&!f;f||g?(g&&(a=[a]),a.forEach(function(a){e(a.ruleType,a.ruleClass,a.validationFunction,a.errorMessage)})):e(a,b,c,d)},d=function(a,b,c,d){this.ruleType=a,this.ruleClass=b,this.validate=c,this.getErrorMessage=d},e=function(c,e,f,g){if("alpha"!==c&&"numeric"!==c)throw new Error('The rule type for a new validation rule must be either "alpha" or "numeric"');if("string"!=typeof e)throw new Error("The rule class for a new validation rule is missing or is not of type string");if("function"!=typeof f)throw new Error("The validation function for a new validation rule is missing or is not of type function");void 0===g&&(g=new Function("",'return "Invalid value";')),"string"==typeof g&&(g=new Function("",'return "'+g+'";'));var h=b(e);if(null!==h){var i=a.indexOf(h);a.splice(i,1)}a.push(new d(c,e,f,g))},f=function(a){var b=a.value,c=a.hasAttribute("data-no-space"),d="^([A-Za-z@.-])+$",e=new RegExp(d.replace(/@/g,c?"":"\\s"));return e.test(b)},g=function(a){return/(^\d{5}([\s-]?\d{4})?$)|(^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} ?\d{1}[A-Z]{1}\d{1}$)/.test(a.value)},h=function(a){var b=(a.value,a.hasAttribute("data-no-space")),c="^([a-zA-Z0-9@]+)$",d=new RegExp(c.replace(/@/g,b?"":"\\s"));return d.test(a.value)},i=function(a){return/^(\S+@\S+\.\S+)$/.test(a.value)},j=function(a){var b=a.value,c=a.hasAttribute("data-no-thousands-separator"),d=/^-?(([\d]{1,3}(,{1}[\d]{3})*)|[\d]+)$/.test(b);return c&&(d=d&&b.indexOf(",")===-1),d},k=function(a){var b="Enter a whole number",c=a.hasAttribute("min"),d=a.hasAttribute("max");return c&&d?b=b+" from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" greater or equal to "+a.getAttribute("min"):d&&(b=b+" lesser or equal to "+a.getAttribute("max")),b},l=function(a){var b=a.value,c=a.hasAttribute("data-no-thousands-separator"),d=a.getAttribute("data-decimal-max");null===d&&(d=2);var e="^-?((([\\d]{1,3}(,[\\d]{3})*)+(\\.[\\d]{1,decimalPlaces})?)|[\\d]+(\\.[\\d]{1,decimalPlaces})?)$",f=new RegExp(e.replace(/decimalPlaces/g,d)),g=f.test(b);return c&&(g=g&&b.indexOf(",")===-1),g},m=function(a){var b="Please enter a number",c=a.hasAttribute("min"),d=a.hasAttribute("max"),e=a.hasAttribute("data-decimal-max")?a.getAttribute("data-decimal-max"):2;return b+=" with "+e+" decimal places max",c&&d?b=b+" and from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" and greater or equal to "+a.getAttribute("min"):d&&(b=b+" and lesser or equal to "+a.getAttribute("max")),b},n=function(a){return/^(\d{4})$/.test(a.value)},o=function(a){var b="Please enter a 4 digit year",c=a.hasAttribute("min"),d=a.hasAttribute("max");return c&&d?b=b+" from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" greater or equal to "+a.getAttribute("min"):d&&(b=b+" lesser or equal to "+a.getAttribute("max")),b},p=function(a){var b=$(a),c=null!==b.datepicker("getDate");return c};return e("alpha","alpha-only",f,"Only letters, spaces, hypens, and periods are allowed"),e("alpha","alpha-zip",g,"Enter a valid zip code"),e("alpha","alpha-numeric",h,"Enter only alphanumeric characters"),e("alpha","alpha-email",i,"Make sure the email is correct"),e("numeric","numeric-whole",j,k),e("numeric","numeric-decimal",l,m),e("numeric","numeric-full-year",n,o),e("numeric","numeric-jquery-date",p,"Please select a date from the date picker"),{getRuleByRuleClass:b,addValidationRule:c}}(),validation=function(){var a=function(a){var d=$(a),e=!0,f=d.prop("disabled")===!0;if(f)return e;var g=d.is("input, textarea"),h=d.is("select");return g&&(e=b(a)),h&&(e=c(a)),e},b=function(a){var b=$(a),c=!0,f=b.hasClass("alpha"),g=b.hasClass("numeric"),h=b.hasClass("optional"),i=b.val(),j=""===$.trim(i)||void 0===i,k=j&&h;return k?c:(f&&(c=d(a)),g&&(c=e(a)),c)},c=function(a){var b=$(a),c=b.val(),d=b.hasClass("optional"),e=""===$.trim(c)||void 0===c,f=d&&e||!e;return f},d=function(a){var b=!0,c=a.getAttribute("pattern"),d=a.getAttribute("class"),e=null!==c;if(e){var f=new RegExp(c,"u");return f.test(a.value)}var g=null===d||""===d;if(g)return b;var h=d.split(" "),i=rules.getRuleByRuleClass(h);return null===i?b:b=i.validate(a)},e=function(a){var b=!0,c=a.getAttribute("pattern"),d=null!==c;if(d){var e=new RegExp(c,"u");b=e.test(a.value)}else{var f=a.getAttribute("class"),g=f?f.split(" "):"",h=rules.getRuleByRuleClass(g);null!==h&&(b=h.validate(a))}if(b){var i=Number(a.value.replace(",",""));if(isNaN(i))return b;var j=a.getAttribute("min"),k=a.getAttribute("max"),l=""===j||null===j?null:Number(j),m=""===k||null===k?null:Number(k),n=null!==l,o=null!==m;n&&o?b=i>=l&&i<=m:n?b=i>=l:o&&(b=i<=m)}return b};return{validateElement:a}}();if("undefined"==typeof jQuery&&"undefined"==typeof $)throw new Error("ritsu.js requires jQuery or a jQuery-compatible API");var ritsu=function(){var a=!1,b=!0,c=!1,d=function(d){var e="object"!=typeof d;if(e)throw new Error("Invalid options to initialize ritsu.js");a=void 0!==d.useBootstrap3Stlying&&d.useBootstrap3Stlying,b=void 0===d.autoMarkInvalidFields||d.autoMarkInvalidFields,c=void 0!==d.autoShowErrorMessages&&d.autoShowErrorMessages;var f=d.validationRules;return void 0!==f&&rules.addValidationRule(f),this},e=function(a){var b=void 0===a;b&&(a=$("input, textarea, select"));var c=!a.is("input, textarea, select");return c&&(a=a.find("input, textarea, select")),a.each(function(){var a=$(this),b=a.is('input[type="checkbox"]'),c=a.is('input[type="radio"]'),d=a.is('input[type="file"]');if(b||c)a.data("initialValue",a.is(":checked"));else if(d){var e=void 0!==a.data("simple-file-hash");if(e)return a.data("initialValue",a.data("simple-file-hash")),!0;var f=this.files.length>0,g=f?this.files[0].name+this.files[0].size:void 0;a.data("initialValue",g)}else a.data("initialValue",a.val())}),this},f=function(a){var b=!1,c=void 0===a;c&&(a=$("input, textarea, select"));var d=!a.is("input, textarea, select");return d&&(a=a.find("input, textarea, select")),a.each(function(){var a=$(this),c=void 0===a.data("initialValue");if(c)return!0;var d=a.is('input[type="checkbox"]'),e=a.is('input[type="radio"]'),f=a.is('input[type="file"]'),g=!1;if(d||e)g=a.data("initialValue")!=a.is(":checked");else if(f){var h=this.files.length>0;g=a.data("initialValue")!=(h?this.files[0].name+this.files[0].size:a.data("simple-file-hash"))}else g=a.data("initialValue")!=a.val();return g?(b=!0,!1):void 0}),b},g=function(a){var d=void 0===a;d&&(a=$("input, textarea, select"));var e=!a.is("input, textarea, select");e&&(a=a.find("input, textarea, select"));var f=!0;return a.each(function(){var a=$(this),b=!validation.validateElement(this);b?(f=!1,a.data("invalid",!0)):(a.data("invalid",!1),j(a))}),b&&h(a),c&&i(a),f},h=function(b){var c=void 0===b;c&&(b=$("input, textarea, select"));var d=!b.is("input, textarea, select");return d&&(b=b.find("input, textarea, select")),b.each(function(){var b=$(this),c=a?b.closest(".form-group"):b,d=b.data("invalid");d?c.addClass("has-error"):c.removeClass("has-error")}),this},i=function(b){var c=void 0===b;c&&(b=$("input, textarea, select"));var d=!b.is("input, textarea, select");return d&&(b=b.find("input, textarea, select")),b.each(function(){var b=$(this);j(b);var c=!b.data("invalid");if(c)return!0;var d=k(this);if(a){var e=b.closest(".form-group"),f=e.find(".help-block"),g=f.length>0;g?f.prepend('<b class="ritsu-error"><em>'+d+'</em></b><br class="ritsu-error">'):e.append('<span class="help-block ritsu-error"><b><em>'+d+"</em></b></span>")}else{var h=b.attr("id"),i=0===b.closest(".error-label-container").length?b.parent():b.closest(".error-label-container");i.append('<label class="error-label"'+(h?' for="'+h+'"':"")+">"+d+"</label>")}}),this},j=function(b){if(b.closest("td").find(".error-label").remove(),a)return void b.closest(".form-group").find(".ritsu-error").remove();var c=b.closest(".error-label-container");0===c.length&&(c=b.parent()),c.find(".error-label, .warning-label").remove()},k=function(a){var b="SELECT"===a.nodeName;if(b)return"Please select an option";var c=a.hasAttribute("data-error-message");if(c)return a.getAttribute("data-error-message");var d="Invalid Value",e=a.getAttribute("class"),f=null===e||""===e;if(f)return d;var g=e.split(" "),h=rules.getRuleByRuleClass(g);return null!==h&&(d=h.getErrorMessage(a)),d};return{rules:rules,initialize:d,storeInitialFormValues:e,isFormDirty:f,validate:g,markInvalidFields:h,showErrorMessages:i}}();
